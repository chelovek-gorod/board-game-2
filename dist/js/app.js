/*! For license information please see app.js.LICENSE.txt */
(()=>{var e={766:(e,t,n)=>{var i;!function(){"use strict";var o=function(){this.init()};o.prototype={init:function(){var e=this||r;return e._counter=1e3,e._html5AudioPool=[],e.html5PoolSize=10,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.autoUnlock=!0,e._setup(),e},volume:function(e){var t=this||r;if(e=parseFloat(e),t.ctx||p(),void 0!==e&&e>=0&&e<=1){if(t._volume=e,t._muted)return t;t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e,r.ctx.currentTime);for(var n=0;n<t._howls.length;n++)if(!t._howls[n]._webAudio)for(var i=t._howls[n]._getSoundIds(),o=0;o<i.length;o++){var s=t._howls[n]._soundById(i[o]);s&&s._node&&(s._node.volume=s._volume*e)}return t}return t._volume},mute:function(e){var t=this||r;t.ctx||p(),t._muted=e,t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e?0:t._volume,r.ctx.currentTime);for(var n=0;n<t._howls.length;n++)if(!t._howls[n]._webAudio)for(var i=t._howls[n]._getSoundIds(),o=0;o<i.length;o++){var s=t._howls[n]._soundById(i[o]);s&&s._node&&(s._node.muted=!!e||s._muted)}return t},stop:function(){for(var e=this||r,t=0;t<e._howls.length;t++)e._howls[t].stop();return e},unload:function(){for(var e=this||r,t=e._howls.length-1;t>=0;t--)e._howls[t].unload();return e.usingWebAudio&&e.ctx&&void 0!==e.ctx.close&&(e.ctx.close(),e.ctx=null,p()),e},codecs:function(e){return(this||r)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||r;if(e.state=e.ctx&&e.ctx.state||"suspended",e._autoSuspend(),!e.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(new Audio).oncanplaythrough&&(e._canPlayEvent="canplay")}catch(t){e.noAudio=!0}else e.noAudio=!0;try{(new Audio).muted&&(e.noAudio=!0)}catch(e){}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||r,t=null;try{t="undefined"!=typeof Audio?new Audio:null}catch(t){return e}if(!t||"function"!=typeof t.canPlayType)return e;var n=t.canPlayType("audio/mpeg;").replace(/^no$/,""),i=e._navigator?e._navigator.userAgent:"",o=i.match(/OPR\/(\d+)/g),s=o&&parseInt(o[0].split("/")[1],10)<33,a=-1!==i.indexOf("Safari")&&-1===i.indexOf("Chrome"),h=i.match(/Version\/(.*?) /),d=a&&h&&parseInt(h[1],10)<15;return e._codecs={mp3:!(s||!n&&!t.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!n,opus:!!t.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(t.canPlayType('audio/wav; codecs="1"')||t.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!t.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!t.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/m4a;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(t.canPlayType("audio/x-m4b;")||t.canPlayType("audio/m4b;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(t.canPlayType("audio/x-mp4;")||t.canPlayType("audio/mp4;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!(d||!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!(d||!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!t.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(t.canPlayType("audio/x-flac;")||t.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_unlockAudio:function(){var e=this||r;if(!e._audioUnlocked&&e.ctx){e._audioUnlocked=!1,e.autoUnlock=!1,e._mobileUnloaded||44100===e.ctx.sampleRate||(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var t=function(n){for(;e._html5AudioPool.length<e.html5PoolSize;)try{var i=new Audio;i._unlocked=!0,e._releaseHtml5Audio(i)}catch(n){e.noAudio=!0;break}for(var o=0;o<e._howls.length;o++)if(!e._howls[o]._webAudio)for(var r=e._howls[o]._getSoundIds(),s=0;s<r.length;s++){var a=e._howls[o]._soundById(r[s]);a&&a._node&&!a._node._unlocked&&(a._node._unlocked=!0,a._node.load())}e._autoResume();var h=e.ctx.createBufferSource();h.buffer=e._scratchBuffer,h.connect(e.ctx.destination),void 0===h.start?h.noteOn(0):h.start(0),"function"==typeof e.ctx.resume&&e.ctx.resume(),h.onended=function(){h.disconnect(0),e._audioUnlocked=!0,document.removeEventListener("touchstart",t,!0),document.removeEventListener("touchend",t,!0),document.removeEventListener("click",t,!0),document.removeEventListener("keydown",t,!0);for(var n=0;n<e._howls.length;n++)e._howls[n]._emit("unlock")}};return document.addEventListener("touchstart",t,!0),document.addEventListener("touchend",t,!0),document.addEventListener("click",t,!0),document.addEventListener("keydown",t,!0),e}},_obtainHtml5Audio:function(){var e=this||r;if(e._html5AudioPool.length)return e._html5AudioPool.pop();var t=(new Audio).play();return t&&"undefined"!=typeof Promise&&(t instanceof Promise||"function"==typeof t.then)&&t.catch((function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")})),new Audio},_releaseHtml5Audio:function(e){var t=this||r;return e._unlocked&&t._html5AudioPool.push(e),t},_autoSuspend:function(){var e=this;if(e.autoSuspend&&e.ctx&&void 0!==e.ctx.suspend&&r.usingWebAudio){for(var t=0;t<e._howls.length;t++)if(e._howls[t]._webAudio)for(var n=0;n<e._howls[t]._sounds.length;n++)if(!e._howls[t]._sounds[n]._paused)return e;return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout((function(){if(e.autoSuspend){e._suspendTimer=null,e.state="suspending";var t=function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())};e.ctx.suspend().then(t,t)}}),3e4),e}},_autoResume:function(){var e=this;if(e.ctx&&void 0!==e.ctx.resume&&r.usingWebAudio)return"running"===e.state&&"interrupted"!==e.ctx.state&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):"suspended"===e.state||"running"===e.state&&"interrupted"===e.ctx.state?(e.ctx.resume().then((function(){e.state="running";for(var t=0;t<e._howls.length;t++)e._howls[t]._emit("resume")})),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):"suspending"===e.state&&(e._resumeAfterSuspend=!0),e}};var r=new o,s=function(e){e.src&&0!==e.src.length?this.init(e):console.error("An array of source files must be passed with any new Howl.")};s.prototype={init:function(e){var t=this;return r.ctx||p(),t._autoplay=e.autoplay||!1,t._format="string"!=typeof e.format?e.format:[e.format],t._html5=e.html5||!1,t._muted=e.mute||!1,t._loop=e.loop||!1,t._pool=e.pool||5,t._preload="boolean"!=typeof e.preload&&"metadata"!==e.preload||e.preload,t._rate=e.rate||1,t._sprite=e.sprite||{},t._src="string"!=typeof e.src?e.src:[e.src],t._volume=void 0!==e.volume?e.volume:1,t._xhr={method:e.xhr&&e.xhr.method?e.xhr.method:"GET",headers:e.xhr&&e.xhr.headers?e.xhr.headers:null,withCredentials:!(!e.xhr||!e.xhr.withCredentials)&&e.xhr.withCredentials},t._duration=0,t._state="unloaded",t._sounds=[],t._endTimers={},t._queue=[],t._playLock=!1,t._onend=e.onend?[{fn:e.onend}]:[],t._onfade=e.onfade?[{fn:e.onfade}]:[],t._onload=e.onload?[{fn:e.onload}]:[],t._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],t._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],t._onpause=e.onpause?[{fn:e.onpause}]:[],t._onplay=e.onplay?[{fn:e.onplay}]:[],t._onstop=e.onstop?[{fn:e.onstop}]:[],t._onmute=e.onmute?[{fn:e.onmute}]:[],t._onvolume=e.onvolume?[{fn:e.onvolume}]:[],t._onrate=e.onrate?[{fn:e.onrate}]:[],t._onseek=e.onseek?[{fn:e.onseek}]:[],t._onunlock=e.onunlock?[{fn:e.onunlock}]:[],t._onresume=[],t._webAudio=r.usingWebAudio&&!t._html5,void 0!==r.ctx&&r.ctx&&r.autoUnlock&&r._unlockAudio(),r._howls.push(t),t._autoplay&&t._queue.push({event:"play",action:function(){t.play()}}),t._preload&&"none"!==t._preload&&t.load(),t},load:function(){var e=this,t=null;if(r.noAudio)e._emit("loaderror",null,"No audio support.");else{"string"==typeof e._src&&(e._src=[e._src]);for(var n=0;n<e._src.length;n++){var i,o;if(e._format&&e._format[n])i=e._format[n];else{if("string"!=typeof(o=e._src[n])){e._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(i=/^data:audio\/([^;,]+);/i.exec(o))||(i=/\.([^.]+)$/.exec(o.split("?",1)[0])),i&&(i=i[1].toLowerCase())}if(i||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),i&&r.codecs(i)){t=e._src[n];break}}if(t)return e._src=t,e._state="loading","https:"===window.location.protocol&&"http:"===t.slice(0,5)&&(e._html5=!0,e._webAudio=!1),new a(e),e._webAudio&&d(e),e;e._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(e,t){var n=this,i=null;if("number"==typeof e)i=e,e=null;else{if("string"==typeof e&&"loaded"===n._state&&!n._sprite[e])return null;if(void 0===e&&(e="__default",!n._playLock)){for(var o=0,s=0;s<n._sounds.length;s++)n._sounds[s]._paused&&!n._sounds[s]._ended&&(o++,i=n._sounds[s]._id);1===o?e=null:i=null}}var a=i?n._soundById(i):n._inactiveSound();if(!a)return null;if(i&&!e&&(e=a._sprite||"__default"),"loaded"!==n._state){a._sprite=e,a._ended=!1;var h=a._id;return n._queue.push({event:"play",action:function(){n.play(h)}}),h}if(i&&!a._paused)return t||n._loadQueue("play"),a._id;n._webAudio&&r._autoResume();var d=Math.max(0,a._seek>0?a._seek:n._sprite[e][0]/1e3),l=Math.max(0,(n._sprite[e][0]+n._sprite[e][1])/1e3-d),u=1e3*l/Math.abs(a._rate),c=n._sprite[e][0]/1e3,p=(n._sprite[e][0]+n._sprite[e][1])/1e3;a._sprite=e,a._ended=!1;var _=function(){a._paused=!1,a._seek=d,a._start=c,a._stop=p,a._loop=!(!a._loop&&!n._sprite[e][2])};if(!(d>=p)){var f=a._node;if(n._webAudio){var m=function(){n._playLock=!1,_(),n._refreshBuffer(a);var e=a._muted||n._muted?0:a._volume;f.gain.setValueAtTime(e,r.ctx.currentTime),a._playStart=r.ctx.currentTime,void 0===f.bufferSource.start?a._loop?f.bufferSource.noteGrainOn(0,d,86400):f.bufferSource.noteGrainOn(0,d,l):a._loop?f.bufferSource.start(0,d,86400):f.bufferSource.start(0,d,l),u!==1/0&&(n._endTimers[a._id]=setTimeout(n._ended.bind(n,a),u)),t||setTimeout((function(){n._emit("play",a._id),n._loadQueue()}),0)};"running"===r.state&&"interrupted"!==r.ctx.state?m():(n._playLock=!0,n.once("resume",m),n._clearTimer(a._id))}else{var y=function(){f.currentTime=d,f.muted=a._muted||n._muted||r._muted||f.muted,f.volume=a._volume*r.volume(),f.playbackRate=a._rate;try{var i=f.play();if(i&&"undefined"!=typeof Promise&&(i instanceof Promise||"function"==typeof i.then)?(n._playLock=!0,_(),i.then((function(){n._playLock=!1,f._unlocked=!0,t?n._loadQueue():n._emit("play",a._id)})).catch((function(){n._playLock=!1,n._emit("playerror",a._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),a._ended=!0,a._paused=!0}))):t||(n._playLock=!1,_(),n._emit("play",a._id)),f.playbackRate=a._rate,f.paused)return void n._emit("playerror",a._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==e||a._loop?n._endTimers[a._id]=setTimeout(n._ended.bind(n,a),u):(n._endTimers[a._id]=function(){n._ended(a),f.removeEventListener("ended",n._endTimers[a._id],!1)},f.addEventListener("ended",n._endTimers[a._id],!1))}catch(e){n._emit("playerror",a._id,e)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===f.src&&(f.src=n._src,f.load());var x=window&&window.ejecta||!f.readyState&&r._navigator.isCocoonJS;if(f.readyState>=3||x)y();else{n._playLock=!0,n._state="loading";var g=function(){n._state="loaded",y(),f.removeEventListener(r._canPlayEvent,g,!1)};f.addEventListener(r._canPlayEvent,g,!1),n._clearTimer(a._id)}}return a._id}n._ended(a)},pause:function(e){var t=this;if("loaded"!==t._state||t._playLock)return t._queue.push({event:"pause",action:function(){t.pause(e)}}),t;for(var n=t._getSoundIds(e),i=0;i<n.length;i++){t._clearTimer(n[i]);var o=t._soundById(n[i]);if(o&&!o._paused&&(o._seek=t.seek(n[i]),o._rateSeek=0,o._paused=!0,t._stopFade(n[i]),o._node))if(t._webAudio){if(!o._node.bufferSource)continue;void 0===o._node.bufferSource.stop?o._node.bufferSource.noteOff(0):o._node.bufferSource.stop(0),t._cleanBuffer(o._node)}else isNaN(o._node.duration)&&o._node.duration!==1/0||o._node.pause();arguments[1]||t._emit("pause",o?o._id:null)}return t},stop:function(e,t){var n=this;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"stop",action:function(){n.stop(e)}}),n;for(var i=n._getSoundIds(e),o=0;o<i.length;o++){n._clearTimer(i[o]);var r=n._soundById(i[o]);r&&(r._seek=r._start||0,r._rateSeek=0,r._paused=!0,r._ended=!0,n._stopFade(i[o]),r._node&&(n._webAudio?r._node.bufferSource&&(void 0===r._node.bufferSource.stop?r._node.bufferSource.noteOff(0):r._node.bufferSource.stop(0),n._cleanBuffer(r._node)):isNaN(r._node.duration)&&r._node.duration!==1/0||(r._node.currentTime=r._start||0,r._node.pause(),r._node.duration===1/0&&n._clearSound(r._node))),t||n._emit("stop",r._id))}return n},mute:function(e,t){var n=this;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"mute",action:function(){n.mute(e,t)}}),n;if(void 0===t){if("boolean"!=typeof e)return n._muted;n._muted=e}for(var i=n._getSoundIds(t),o=0;o<i.length;o++){var s=n._soundById(i[o]);s&&(s._muted=e,s._interval&&n._stopFade(s._id),n._webAudio&&s._node?s._node.gain.setValueAtTime(e?0:s._volume,r.ctx.currentTime):s._node&&(s._node.muted=!!r._muted||e),n._emit("mute",s._id))}return n},volume:function(){var e,t,n,i=this,o=arguments;if(0===o.length)return i._volume;if(1===o.length||2===o.length&&void 0===o[1]?i._getSoundIds().indexOf(o[0])>=0?t=parseInt(o[0],10):e=parseFloat(o[0]):o.length>=2&&(e=parseFloat(o[0]),t=parseInt(o[1],10)),!(void 0!==e&&e>=0&&e<=1))return(n=t?i._soundById(t):i._sounds[0])?n._volume:0;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"volume",action:function(){i.volume.apply(i,o)}}),i;void 0===t&&(i._volume=e),t=i._getSoundIds(t);for(var s=0;s<t.length;s++)(n=i._soundById(t[s]))&&(n._volume=e,o[2]||i._stopFade(t[s]),i._webAudio&&n._node&&!n._muted?n._node.gain.setValueAtTime(e,r.ctx.currentTime):n._node&&!n._muted&&(n._node.volume=e*r.volume()),i._emit("volume",n._id));return i},fade:function(e,t,n,i){var o=this;if("loaded"!==o._state||o._playLock)return o._queue.push({event:"fade",action:function(){o.fade(e,t,n,i)}}),o;e=Math.min(Math.max(0,parseFloat(e)),1),t=Math.min(Math.max(0,parseFloat(t)),1),n=parseFloat(n),o.volume(e,i);for(var s=o._getSoundIds(i),a=0;a<s.length;a++){var h=o._soundById(s[a]);if(h){if(i||o._stopFade(s[a]),o._webAudio&&!h._muted){var d=r.ctx.currentTime,l=d+n/1e3;h._volume=e,h._node.gain.setValueAtTime(e,d),h._node.gain.linearRampToValueAtTime(t,l)}o._startFadeInterval(h,e,t,n,s[a],void 0===i)}}return o},_startFadeInterval:function(e,t,n,i,o,r){var s=this,a=t,h=n-t,d=Math.abs(h/.01),l=Math.max(4,d>0?i/d:i),u=Date.now();e._fadeTo=n,e._interval=setInterval((function(){var o=(Date.now()-u)/i;u=Date.now(),a+=h*o,a=Math.round(100*a)/100,a=h<0?Math.max(n,a):Math.min(n,a),s._webAudio?e._volume=a:s.volume(a,e._id,!0),r&&(s._volume=a),(n<t&&a<=n||n>t&&a>=n)&&(clearInterval(e._interval),e._interval=null,e._fadeTo=null,s.volume(n,e._id),s._emit("fade",e._id))}),l)},_stopFade:function(e){var t=this,n=t._soundById(e);return n&&n._interval&&(t._webAudio&&n._node.gain.cancelScheduledValues(r.ctx.currentTime),clearInterval(n._interval),n._interval=null,t.volume(n._fadeTo,e),n._fadeTo=null,t._emit("fade",e)),t},loop:function(){var e,t,n,i=this,o=arguments;if(0===o.length)return i._loop;if(1===o.length){if("boolean"!=typeof o[0])return!!(n=i._soundById(parseInt(o[0],10)))&&n._loop;e=o[0],i._loop=e}else 2===o.length&&(e=o[0],t=parseInt(o[1],10));for(var r=i._getSoundIds(t),s=0;s<r.length;s++)(n=i._soundById(r[s]))&&(n._loop=e,i._webAudio&&n._node&&n._node.bufferSource&&(n._node.bufferSource.loop=e,e&&(n._node.bufferSource.loopStart=n._start||0,n._node.bufferSource.loopEnd=n._stop,i.playing(r[s])&&(i.pause(r[s],!0),i.play(r[s],!0)))));return i},rate:function(){var e,t,n,i=this,o=arguments;if(0===o.length?t=i._sounds[0]._id:1===o.length?i._getSoundIds().indexOf(o[0])>=0?t=parseInt(o[0],10):e=parseFloat(o[0]):2===o.length&&(e=parseFloat(o[0]),t=parseInt(o[1],10)),"number"!=typeof e)return(n=i._soundById(t))?n._rate:i._rate;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"rate",action:function(){i.rate.apply(i,o)}}),i;void 0===t&&(i._rate=e),t=i._getSoundIds(t);for(var s=0;s<t.length;s++)if(n=i._soundById(t[s])){i.playing(t[s])&&(n._rateSeek=i.seek(t[s]),n._playStart=i._webAudio?r.ctx.currentTime:n._playStart),n._rate=e,i._webAudio&&n._node&&n._node.bufferSource?n._node.bufferSource.playbackRate.setValueAtTime(e,r.ctx.currentTime):n._node&&(n._node.playbackRate=e);var a=i.seek(t[s]),h=1e3*((i._sprite[n._sprite][0]+i._sprite[n._sprite][1])/1e3-a)/Math.abs(n._rate);!i._endTimers[t[s]]&&n._paused||(i._clearTimer(t[s]),i._endTimers[t[s]]=setTimeout(i._ended.bind(i,n),h)),i._emit("rate",n._id)}return i},seek:function(){var e,t,n=this,i=arguments;if(0===i.length?n._sounds.length&&(t=n._sounds[0]._id):1===i.length?n._getSoundIds().indexOf(i[0])>=0?t=parseInt(i[0],10):n._sounds.length&&(t=n._sounds[0]._id,e=parseFloat(i[0])):2===i.length&&(e=parseFloat(i[0]),t=parseInt(i[1],10)),void 0===t)return 0;if("number"==typeof e&&("loaded"!==n._state||n._playLock))return n._queue.push({event:"seek",action:function(){n.seek.apply(n,i)}}),n;var o=n._soundById(t);if(o){if(!("number"==typeof e&&e>=0)){if(n._webAudio){var s=n.playing(t)?r.ctx.currentTime-o._playStart:0,a=o._rateSeek?o._rateSeek-o._seek:0;return o._seek+(a+s*Math.abs(o._rate))}return o._node.currentTime}var h=n.playing(t);h&&n.pause(t,!0),o._seek=e,o._ended=!1,n._clearTimer(t),n._webAudio||!o._node||isNaN(o._node.duration)||(o._node.currentTime=e);var d=function(){h&&n.play(t,!0),n._emit("seek",t)};if(h&&!n._webAudio){var l=function(){n._playLock?setTimeout(l,0):d()};setTimeout(l,0)}else d()}return n},playing:function(e){var t=this;if("number"==typeof e){var n=t._soundById(e);return!!n&&!n._paused}for(var i=0;i<t._sounds.length;i++)if(!t._sounds[i]._paused)return!0;return!1},duration:function(e){var t=this,n=t._duration,i=t._soundById(e);return i&&(n=t._sprite[i._sprite][1]/1e3),n},state:function(){return this._state},unload:function(){for(var e=this,t=e._sounds,n=0;n<t.length;n++)t[n]._paused||e.stop(t[n]._id),e._webAudio||(e._clearSound(t[n]._node),t[n]._node.removeEventListener("error",t[n]._errorFn,!1),t[n]._node.removeEventListener(r._canPlayEvent,t[n]._loadFn,!1),t[n]._node.removeEventListener("ended",t[n]._endFn,!1),r._releaseHtml5Audio(t[n]._node)),delete t[n]._node,e._clearTimer(t[n]._id);var i=r._howls.indexOf(e);i>=0&&r._howls.splice(i,1);var o=!0;for(n=0;n<r._howls.length;n++)if(r._howls[n]._src===e._src||e._src.indexOf(r._howls[n]._src)>=0){o=!1;break}return h&&o&&delete h[e._src],r.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,t,n,i){var o=this["_on"+e];return"function"==typeof t&&o.push(i?{id:n,fn:t,once:i}:{id:n,fn:t}),this},off:function(e,t,n){var i=this,o=i["_on"+e],r=0;if("number"==typeof t&&(n=t,t=null),t||n)for(r=0;r<o.length;r++){var s=n===o[r].id;if(t===o[r].fn&&s||!t&&s){o.splice(r,1);break}}else if(e)i["_on"+e]=[];else{var a=Object.keys(i);for(r=0;r<a.length;r++)0===a[r].indexOf("_on")&&Array.isArray(i[a[r]])&&(i[a[r]]=[])}return i},once:function(e,t,n){return this.on(e,t,n,1),this},_emit:function(e,t,n){for(var i=this,o=i["_on"+e],r=o.length-1;r>=0;r--)o[r].id&&o[r].id!==t&&"load"!==e||(setTimeout(function(e){e.call(this,t,n)}.bind(i,o[r].fn),0),o[r].once&&i.off(e,o[r].fn,o[r].id));return i._loadQueue(e),i},_loadQueue:function(e){var t=this;if(t._queue.length>0){var n=t._queue[0];n.event===e&&(t._queue.shift(),t._loadQueue()),e||n.action()}return t},_ended:function(e){var t=this,n=e._sprite;if(!t._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop)return setTimeout(t._ended.bind(t,e),100),t;var i=!(!e._loop&&!t._sprite[n][2]);if(t._emit("end",e._id),!t._webAudio&&i&&t.stop(e._id,!0).play(e._id),t._webAudio&&i){t._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=r.ctx.currentTime;var o=1e3*(e._stop-e._start)/Math.abs(e._rate);t._endTimers[e._id]=setTimeout(t._ended.bind(t,e),o)}return t._webAudio&&!i&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,t._clearTimer(e._id),t._cleanBuffer(e._node),r._autoSuspend()),t._webAudio||i||t.stop(e._id,!0),t},_clearTimer:function(e){var t=this;if(t._endTimers[e]){if("function"!=typeof t._endTimers[e])clearTimeout(t._endTimers[e]);else{var n=t._soundById(e);n&&n._node&&n._node.removeEventListener("ended",t._endTimers[e],!1)}delete t._endTimers[e]}return t},_soundById:function(e){for(var t=this,n=0;n<t._sounds.length;n++)if(e===t._sounds[n]._id)return t._sounds[n];return null},_inactiveSound:function(){var e=this;e._drain();for(var t=0;t<e._sounds.length;t++)if(e._sounds[t]._ended)return e._sounds[t].reset();return new a(e)},_drain:function(){var e=this,t=e._pool,n=0,i=0;if(!(e._sounds.length<t)){for(i=0;i<e._sounds.length;i++)e._sounds[i]._ended&&n++;for(i=e._sounds.length-1;i>=0;i--){if(n<=t)return;e._sounds[i]._ended&&(e._webAudio&&e._sounds[i]._node&&e._sounds[i]._node.disconnect(0),e._sounds.splice(i,1),n--)}}},_getSoundIds:function(e){if(void 0===e){for(var t=[],n=0;n<this._sounds.length;n++)t.push(this._sounds[n]._id);return t}return[e]},_refreshBuffer:function(e){return e._node.bufferSource=r.ctx.createBufferSource(),e._node.bufferSource.buffer=h[this._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop||0),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,r.ctx.currentTime),this},_cleanBuffer:function(e){var t=r._navigator&&r._navigator.vendor.indexOf("Apple")>=0;if(!e.bufferSource)return this;if(r._scratchBuffer&&e.bufferSource&&(e.bufferSource.onended=null,e.bufferSource.disconnect(0),t))try{e.bufferSource.buffer=r._scratchBuffer}catch(e){}return e.bufferSource=null,this},_clearSound:function(e){/MSIE |Trident\//.test(r._navigator&&r._navigator.userAgent)||(e.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var a=function(e){this._parent=e,this.init()};a.prototype={init:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++r._counter,t._sounds.push(e),e.create(),e},create:function(){var e=this,t=e._parent,n=r._muted||e._muted||e._parent._muted?0:e._volume;return t._webAudio?(e._node=void 0===r.ctx.createGain?r.ctx.createGainNode():r.ctx.createGain(),e._node.gain.setValueAtTime(n,r.ctx.currentTime),e._node.paused=!0,e._node.connect(r.masterGain)):r.noAudio||(e._node=r._obtainHtml5Audio(),e._errorFn=e._errorListener.bind(e),e._node.addEventListener("error",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener(r._canPlayEvent,e._loadFn,!1),e._endFn=e._endListener.bind(e),e._node.addEventListener("ended",e._endFn,!1),e._node.src=t._src,e._node.preload=!0===t._preload?"auto":t._preload,e._node.volume=n*r.volume(),e._node.load()),e},reset:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._rateSeek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++r._counter,e},_errorListener:function(){var e=this;e._parent._emit("loaderror",e._id,e._node.error?e._node.error.code:0),e._node.removeEventListener("error",e._errorFn,!1)},_loadListener:function(){var e=this,t=e._parent;t._duration=Math.ceil(10*e._node.duration)/10,0===Object.keys(t._sprite).length&&(t._sprite={__default:[0,1e3*t._duration]}),"loaded"!==t._state&&(t._state="loaded",t._emit("load"),t._loadQueue()),e._node.removeEventListener(r._canPlayEvent,e._loadFn,!1)},_endListener:function(){var e=this,t=e._parent;t._duration===1/0&&(t._duration=Math.ceil(10*e._node.duration)/10,t._sprite.__default[1]===1/0&&(t._sprite.__default[1]=1e3*t._duration),t._ended(e)),e._node.removeEventListener("ended",e._endFn,!1)}};var h={},d=function(e){var t=e._src;if(h[t])return e._duration=h[t].duration,void c(e);if(/^data:[^;]+;base64,/.test(t)){for(var n=atob(t.split(",")[1]),i=new Uint8Array(n.length),o=0;o<n.length;++o)i[o]=n.charCodeAt(o);u(i.buffer,e)}else{var r=new XMLHttpRequest;r.open(e._xhr.method,t,!0),r.withCredentials=e._xhr.withCredentials,r.responseType="arraybuffer",e._xhr.headers&&Object.keys(e._xhr.headers).forEach((function(t){r.setRequestHeader(t,e._xhr.headers[t])})),r.onload=function(){var t=(r.status+"")[0];"0"===t||"2"===t||"3"===t?u(r.response,e):e._emit("loaderror",null,"Failed loading audio file with status: "+r.status+".")},r.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete h[t],e.load())},l(r)}},l=function(e){try{e.send()}catch(t){e.onerror()}},u=function(e,t){var n=function(){t._emit("loaderror",null,"Decoding audio data failed.")},i=function(e){e&&t._sounds.length>0?(h[t._src]=e,c(t,e)):n()};"undefined"!=typeof Promise&&1===r.ctx.decodeAudioData.length?r.ctx.decodeAudioData(e).then(i).catch(n):r.ctx.decodeAudioData(e,i,n)},c=function(e,t){t&&!e._duration&&(e._duration=t.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue())},p=function(){if(r.usingWebAudio){try{"undefined"!=typeof AudioContext?r.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?r.ctx=new webkitAudioContext:r.usingWebAudio=!1}catch(e){r.usingWebAudio=!1}r.ctx||(r.usingWebAudio=!1);var e=/iP(hone|od|ad)/.test(r._navigator&&r._navigator.platform),t=r._navigator&&r._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),n=t?parseInt(t[1],10):null;if(e&&n&&n<9){var i=/safari/.test(r._navigator&&r._navigator.userAgent.toLowerCase());r._navigator&&!i&&(r.usingWebAudio=!1)}r.usingWebAudio&&(r.masterGain=void 0===r.ctx.createGain?r.ctx.createGainNode():r.ctx.createGain(),r.masterGain.gain.setValueAtTime(r._muted?0:r._volume,r.ctx.currentTime),r.masterGain.connect(r.ctx.destination)),r._setup()}};void 0===(i=function(){return{Howler:r,Howl:s}}.apply(t,[]))||(e.exports=i),t.Howler=r,t.Howl=s,void 0!==n.g?(n.g.HowlerGlobal=o,n.g.Howler=r,n.g.Howl=s,n.g.Sound=a):"undefined"!=typeof window&&(window.HowlerGlobal=o,window.Howler=r,window.Howl=s,window.Sound=a)}(),function(){"use strict";var e;HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){var t=this;if(!t.ctx||!t.ctx.listener)return t;for(var n=t._howls.length-1;n>=0;n--)t._howls[n].stereo(e);return t},HowlerGlobal.prototype.pos=function(e,t,n){var i=this;return i.ctx&&i.ctx.listener?(t="number"!=typeof t?i._pos[1]:t,n="number"!=typeof n?i._pos[2]:n,"number"!=typeof e?i._pos:(i._pos=[e,t,n],void 0!==i.ctx.listener.positionX?(i.ctx.listener.positionX.setTargetAtTime(i._pos[0],Howler.ctx.currentTime,.1),i.ctx.listener.positionY.setTargetAtTime(i._pos[1],Howler.ctx.currentTime,.1),i.ctx.listener.positionZ.setTargetAtTime(i._pos[2],Howler.ctx.currentTime,.1)):i.ctx.listener.setPosition(i._pos[0],i._pos[1],i._pos[2]),i)):i},HowlerGlobal.prototype.orientation=function(e,t,n,i,o,r){var s=this;if(!s.ctx||!s.ctx.listener)return s;var a=s._orientation;return t="number"!=typeof t?a[1]:t,n="number"!=typeof n?a[2]:n,i="number"!=typeof i?a[3]:i,o="number"!=typeof o?a[4]:o,r="number"!=typeof r?a[5]:r,"number"!=typeof e?a:(s._orientation=[e,t,n,i,o,r],void 0!==s.ctx.listener.forwardX?(s.ctx.listener.forwardX.setTargetAtTime(e,Howler.ctx.currentTime,.1),s.ctx.listener.forwardY.setTargetAtTime(t,Howler.ctx.currentTime,.1),s.ctx.listener.forwardZ.setTargetAtTime(n,Howler.ctx.currentTime,.1),s.ctx.listener.upX.setTargetAtTime(i,Howler.ctx.currentTime,.1),s.ctx.listener.upY.setTargetAtTime(o,Howler.ctx.currentTime,.1),s.ctx.listener.upZ.setTargetAtTime(r,Howler.ctx.currentTime,.1)):s.ctx.listener.setOrientation(e,t,n,i,o,r),s)},Howl.prototype.init=(e=Howl.prototype.init,function(t){var n=this;return n._orientation=t.orientation||[1,0,0],n._stereo=t.stereo||null,n._pos=t.pos||null,n._pannerAttr={coneInnerAngle:void 0!==t.coneInnerAngle?t.coneInnerAngle:360,coneOuterAngle:void 0!==t.coneOuterAngle?t.coneOuterAngle:360,coneOuterGain:void 0!==t.coneOuterGain?t.coneOuterGain:0,distanceModel:void 0!==t.distanceModel?t.distanceModel:"inverse",maxDistance:void 0!==t.maxDistance?t.maxDistance:1e4,panningModel:void 0!==t.panningModel?t.panningModel:"HRTF",refDistance:void 0!==t.refDistance?t.refDistance:1,rolloffFactor:void 0!==t.rolloffFactor?t.rolloffFactor:1},n._onstereo=t.onstereo?[{fn:t.onstereo}]:[],n._onpos=t.onpos?[{fn:t.onpos}]:[],n._onorientation=t.onorientation?[{fn:t.onorientation}]:[],e.call(this,t)}),Howl.prototype.stereo=function(e,n){var i=this;if(!i._webAudio)return i;if("loaded"!==i._state)return i._queue.push({event:"stereo",action:function(){i.stereo(e,n)}}),i;var o=void 0===Howler.ctx.createStereoPanner?"spatial":"stereo";if(void 0===n){if("number"!=typeof e)return i._stereo;i._stereo=e,i._pos=[e,0,0]}for(var r=i._getSoundIds(n),s=0;s<r.length;s++){var a=i._soundById(r[s]);if(a){if("number"!=typeof e)return a._stereo;a._stereo=e,a._pos=[e,0,0],a._node&&(a._pannerAttr.panningModel="equalpower",a._panner&&a._panner.pan||t(a,o),"spatial"===o?void 0!==a._panner.positionX?(a._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),a._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),a._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):a._panner.setPosition(e,0,0):a._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),i._emit("stereo",a._id)}}return i},Howl.prototype.pos=function(e,n,i,o){var r=this;if(!r._webAudio)return r;if("loaded"!==r._state)return r._queue.push({event:"pos",action:function(){r.pos(e,n,i,o)}}),r;if(n="number"!=typeof n?0:n,i="number"!=typeof i?-.5:i,void 0===o){if("number"!=typeof e)return r._pos;r._pos=[e,n,i]}for(var s=r._getSoundIds(o),a=0;a<s.length;a++){var h=r._soundById(s[a]);if(h){if("number"!=typeof e)return h._pos;h._pos=[e,n,i],h._node&&(h._panner&&!h._panner.pan||t(h,"spatial"),void 0!==h._panner.positionX?(h._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),h._panner.positionY.setValueAtTime(n,Howler.ctx.currentTime),h._panner.positionZ.setValueAtTime(i,Howler.ctx.currentTime)):h._panner.setPosition(e,n,i)),r._emit("pos",h._id)}}return r},Howl.prototype.orientation=function(e,n,i,o){var r=this;if(!r._webAudio)return r;if("loaded"!==r._state)return r._queue.push({event:"orientation",action:function(){r.orientation(e,n,i,o)}}),r;if(n="number"!=typeof n?r._orientation[1]:n,i="number"!=typeof i?r._orientation[2]:i,void 0===o){if("number"!=typeof e)return r._orientation;r._orientation=[e,n,i]}for(var s=r._getSoundIds(o),a=0;a<s.length;a++){var h=r._soundById(s[a]);if(h){if("number"!=typeof e)return h._orientation;h._orientation=[e,n,i],h._node&&(h._panner||(h._pos||(h._pos=r._pos||[0,0,-.5]),t(h,"spatial")),void 0!==h._panner.orientationX?(h._panner.orientationX.setValueAtTime(e,Howler.ctx.currentTime),h._panner.orientationY.setValueAtTime(n,Howler.ctx.currentTime),h._panner.orientationZ.setValueAtTime(i,Howler.ctx.currentTime)):h._panner.setOrientation(e,n,i)),r._emit("orientation",h._id)}}return r},Howl.prototype.pannerAttr=function(){var e,n,i,o=this,r=arguments;if(!o._webAudio)return o;if(0===r.length)return o._pannerAttr;if(1===r.length){if("object"!=typeof r[0])return(i=o._soundById(parseInt(r[0],10)))?i._pannerAttr:o._pannerAttr;e=r[0],void 0===n&&(e.pannerAttr||(e.pannerAttr={coneInnerAngle:e.coneInnerAngle,coneOuterAngle:e.coneOuterAngle,coneOuterGain:e.coneOuterGain,distanceModel:e.distanceModel,maxDistance:e.maxDistance,refDistance:e.refDistance,rolloffFactor:e.rolloffFactor,panningModel:e.panningModel}),o._pannerAttr={coneInnerAngle:void 0!==e.pannerAttr.coneInnerAngle?e.pannerAttr.coneInnerAngle:o._coneInnerAngle,coneOuterAngle:void 0!==e.pannerAttr.coneOuterAngle?e.pannerAttr.coneOuterAngle:o._coneOuterAngle,coneOuterGain:void 0!==e.pannerAttr.coneOuterGain?e.pannerAttr.coneOuterGain:o._coneOuterGain,distanceModel:void 0!==e.pannerAttr.distanceModel?e.pannerAttr.distanceModel:o._distanceModel,maxDistance:void 0!==e.pannerAttr.maxDistance?e.pannerAttr.maxDistance:o._maxDistance,refDistance:void 0!==e.pannerAttr.refDistance?e.pannerAttr.refDistance:o._refDistance,rolloffFactor:void 0!==e.pannerAttr.rolloffFactor?e.pannerAttr.rolloffFactor:o._rolloffFactor,panningModel:void 0!==e.pannerAttr.panningModel?e.pannerAttr.panningModel:o._panningModel})}else 2===r.length&&(e=r[0],n=parseInt(r[1],10));for(var s=o._getSoundIds(n),a=0;a<s.length;a++)if(i=o._soundById(s[a])){var h=i._pannerAttr;h={coneInnerAngle:void 0!==e.coneInnerAngle?e.coneInnerAngle:h.coneInnerAngle,coneOuterAngle:void 0!==e.coneOuterAngle?e.coneOuterAngle:h.coneOuterAngle,coneOuterGain:void 0!==e.coneOuterGain?e.coneOuterGain:h.coneOuterGain,distanceModel:void 0!==e.distanceModel?e.distanceModel:h.distanceModel,maxDistance:void 0!==e.maxDistance?e.maxDistance:h.maxDistance,refDistance:void 0!==e.refDistance?e.refDistance:h.refDistance,rolloffFactor:void 0!==e.rolloffFactor?e.rolloffFactor:h.rolloffFactor,panningModel:void 0!==e.panningModel?e.panningModel:h.panningModel};var d=i._panner;d||(i._pos||(i._pos=o._pos||[0,0,-.5]),t(i,"spatial"),d=i._panner),d.coneInnerAngle=h.coneInnerAngle,d.coneOuterAngle=h.coneOuterAngle,d.coneOuterGain=h.coneOuterGain,d.distanceModel=h.distanceModel,d.maxDistance=h.maxDistance,d.refDistance=h.refDistance,d.rolloffFactor=h.rolloffFactor,d.panningModel=h.panningModel}return o},Sound.prototype.init=function(e){return function(){var t=this,n=t._parent;t._orientation=n._orientation,t._stereo=n._stereo,t._pos=n._pos,t._pannerAttr=n._pannerAttr,e.call(this),t._stereo?n.stereo(t._stereo):t._pos&&n.pos(t._pos[0],t._pos[1],t._pos[2],t._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var t=this,n=t._parent;return t._orientation=n._orientation,t._stereo=n._stereo,t._pos=n._pos,t._pannerAttr=n._pannerAttr,t._stereo?n.stereo(t._stereo):t._pos?n.pos(t._pos[0],t._pos[1],t._pos[2],t._id):t._panner&&(t._panner.disconnect(0),t._panner=void 0,n._refreshBuffer(t)),e.call(this)}}(Sound.prototype.reset);var t=function(e,t){"spatial"===(t=t||"spatial")?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,void 0!==e._panner.positionX?(e._panner.positionX.setValueAtTime(e._pos[0],Howler.ctx.currentTime),e._panner.positionY.setValueAtTime(e._pos[1],Howler.ctx.currentTime),e._panner.positionZ.setValueAtTime(e._pos[2],Howler.ctx.currentTime)):e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),void 0!==e._panner.orientationX?(e._panner.orientationX.setValueAtTime(e._orientation[0],Howler.ctx.currentTime),e._panner.orientationY.setValueAtTime(e._orientation[1],Howler.ctx.currentTime),e._panner.orientationZ.setValueAtTime(e._orientation[2],Howler.ctx.currentTime)):e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}}()}},t={};function n(i){var o=t[i];if(void 0!==o)return o.exports;var r=t[i]={exports:{}};return e[i](r,r.exports,n),r.exports}n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var i={};(()=>{"use strict";n.d(i,{H:()=>te});const e={helpBook:"book_202x112px.png",help1:"help_01_920x920px.png",help2:"help_02_920x920px.png",help3:"help_03_920x920px.png",help4:"help_04_920x920px.png",help5:"help_05_920x920px.png",help6:"help_06_920x920px.png",help7:"help_07_920x920px.png",help8:"help_08_920x920px.png",help9:"help_09_920x920px.png",help10:"help_10_920x920px.png",help11:"help_11_920x920px.png",help12:"help_12_920x920px.png",menuLogo:"MarsGameLogoDarkBg.png",menuButton:"options_button_128x128px.png",menuButtonLock:"options_button_lock_128x128px.png",menuPlayer:"use_player_128x128px.png",menuComputer:"use_computer_128x128px.png",menuNoUser:"use_no_128x128px.png",menuRandom:"use_random_128x128px.png",menuMusicOn:"options_music_on_128x128px.png",menuMusicOff:"options_music_off_128x128px.png",menuEffectsOn:"options_effects_on_128x128px.png",menuEffectsOff:"options_effects_off_128x128px.png",board:"board.svg",dice:"dices_84x84px_mixed_frames.png",dicePointer:"pointer_dice_160x160px.png",pointerPlayerH:"turn_bw_480x120px_32frames.png",pointerPlayerV:"turn_bw_120x480px_32frames.png",tokenPointerHuman:"pointer_token_human_160x160px.png",tokenPointerBot:"pointer_token_bot_160x160px.png",tokenBomb:"token_bomb_128x128px.png",tokenButton:"token_button_128x128px.png",tokenCap:"token_cap_128x128px.png",tokenCoin:"token_coin_128x128px.png",tokenCrystal:"token_crystal_128x128px.png",tokenDragon:"token_dragon_128x128px.png",tokenEye:"token_eye_128x128px.png",tokenHelmet:"token_helmet_128x128px.png",tokenMask:"token_mask_128x128px.png",tokenMolecule:"token_molecule_128x128px.png",tokenMoon:"token_moon_128x128px.png",tokenNut:"token_nut_128x128px.png",tokenPlane:"token_plane_128x128px.png",tokenShark:"token_shark_128x128px.png",tokenShield:"token_shield_128x128px.png",tokenSkull:"token_skull_128x128px.png",tokenStone:"token_stone_128x128px.png",tokenToy:"token_toy_128x128px.png",tokenUfo:"token_ufo_128x128px.png",tokenWheel:"token_wheel_128x128px.png"},t={menuToken:"se_menu_click.mp3",menuClick:"se_menu_token.mp3",menuEffects:"se_menu_effects.mp3",menuMusic:"se_menu_music.mp3",menuStart:"se_menu_start.mp3",dice:"se_dices.mp3",dice2:"se_dices2.mp3",startToken:"se_start_token.mp3",step0:"se_step_0.mp3",step1:"se_step_1.mp3",step2:"se_step_2.mp3",step3:"se_step_3.mp3",toiletStart:"se_toilet_start.mp3",toilet0:"se_toilet_0.mp3",toilet1:"se_toilet_1.mp3",toilet2:"se_toilet_2.mp3",toilet3:"se_toilet_3.mp3",toiletExit:"se_toilet_exit.mp3",home:"se_home.mp3",corner:"se_corner.mp3",port:"se_port.mp3",destroy:"se_destroy.mp3",win:"se_final_win.mp3",lose:"se_final_lose.mp3"},o={files:0,loaded:0},r={version:"1.0.0",ceilSize:120,boardOffset:20,gameStartDuration:1800,diceThrowDuration:1e3,diceActiveDuration:800,tokenStepDuration:600,tokenPointerScaleDuration:600};class s{static instance;constructor(){if(s.instance)return s.instance;this.canvas=document.getElementById("canvas"),this.width=this.canvas.width=15*r.ceilSize+2*r.boardOffset,this.height=this.canvas.height=15*r.ceilSize+2*r.boardOffset,this.sizeRate=1,this.size=0,this.x=Math.round(this.width/2),this.y=Math.round(this.height/2),this.context=this.canvas.getContext("2d"),this.layers=[],s.instance=this,this.resize()}resize(){this.size=innerWidth>innerHeight?innerHeight:innerWidth,this.sizeRate=this.width/this.size}getLayer(e){return this.layers.find((t=>t.name===e))}}const a=s,h=document.querySelector(".top-left"),d=document.querySelector(".bottom-right"),l=document.getElementById("help"),u=document.getElementById("helpContent"),c=document.getElementById("imageHelp"),p=document.getElementById("closeHelp");let _=[],f=0,m=document.createElement("div");function y(e){"top"===e.side?d.append(m):h.append(m)}function x(){O(l)}function g(){c.innerHTML="",c.append(_[f]),f++,f===_.length&&(f=0)}m.id="helpButtonDiv",m.onclick=function(){g(),D(l)},p.onclick=x,u.onclick=g;const{Howl:v}=n(766),b={music:!0,effects:!0};function k(e){const t=b.music;b.music=e.music,b.effects=e.effects,t!==b.music&&(b.music?P.play():P.pause())}let w=Math.floor(4*Math.random()),T=Math.floor(4*Math.random());function A(e){if(b.effects)if("string"!=typeof e)e.currentTime=0,e.play();else switch(e){case"step":t["step"+w].play(),w++,w>3&&(w=0);break;case"toilet":t["toilet"+T].play(),T++,T>3&&(T=0)}}const S=["bgm_western_0.mp3","bgm_western_1.mp3","bgm_western_2.mp3","bgm_western_3.mp3","bgm_western_4.mp3"];let I=Math.floor(Math.random()*S.length),P=null;function z(){I++,I===S.length&&(I=0);P=function(e){return new v({src:["./src/music/"+e],volume:.5,onend:z})}(S[I]),P.play()}const E=new a,X=document.getElementById("shell"),B=document.getElementById("gameDiv");let M=!1,Y=!0;function H(){return B.offsetWidth>B.offsetHeight?{width:B.offsetWidth-E.canvas.offsetWidth,height:E.canvas.offsetHeight,yandexWidth:screen.availWidth-B.offsetWidth,yandexHeight:E.canvas.offsetHeight,side:"right"}:{width:E.canvas.offsetWidth,height:B.offsetHeight-E.canvas.offsetHeight,yandexWidth:E.canvas.offsetWidth,yandexHeight:screen.availHeight-B.offsetHeight,side:"top"}}function D(e,t){t&&(e.innerHTML=t),e.style.display="flex",setTimeout((()=>e.style.opacity=1),0)}function O(e,t){t&&(e.innerHTML=t),e.style.opacity=0,setTimeout((()=>e.style.display="none"),1200)}function L(){P.pause(),D(X),Y=!1,cancelAnimationFrame(F)}document.body.onresize=()=>{E.resize(),document.fullscreenEnabled&&!document.fullscreenElement&&L(),x(),M&&y(H())},X.onclick=()=>{O(X),b.music&&(P?P.play():z()),Y=!0,C=performance.now(),F=requestAnimationFrame(U),document.fullscreenEnabled&&!document.fullscreenElement&&document.body.requestFullscreen(),M||(M=!0,D(B),y(H()))},document.body.onblur=L;let C=performance.now(),F=requestAnimationFrame(U);function U(e){const t=e-C;C=e,E.context.clearRect(0,0,E.width,E.height),E.layers.forEach((e=>e.update(t))),Y&&(F=requestAnimationFrame(U))}const G=E,R=class{constructor(){this.image=e.board,this.ceilSize=r.ceilSize,this.imageSize=13*this.ceilSize,this.imageOffset=r.boardOffset+r.ceilSize,this.reserveTop=[{isEmpty:!0,targetIndex:6,x:0,y:0,rateX:5.5,rateY:0},{isEmpty:!0,targetIndex:6,x:0,y:0,rateX:6.5,rateY:0},{isEmpty:!0,targetIndex:6,x:0,y:0,rateX:7.5,rateY:0},{isEmpty:!0,targetIndex:6,x:0,y:0,rateX:8.5,rateY:0}],this.reserveRight=[{isEmpty:!0,targetIndex:18,x:0,y:0,rateX:14,rateY:5.5},{isEmpty:!0,targetIndex:18,x:0,y:0,rateX:14,rateY:6.5},{isEmpty:!0,targetIndex:18,x:0,y:0,rateX:14,rateY:7.5},{isEmpty:!0,targetIndex:18,x:0,y:0,rateX:14,rateY:8.5}],this.reserveBottom=[{isEmpty:!0,targetIndex:30,x:0,y:0,rateX:5.5,rateY:14},{isEmpty:!0,targetIndex:30,x:0,y:0,rateX:6.5,rateY:14},{isEmpty:!0,targetIndex:30,x:0,y:0,rateX:7.5,rateY:14},{isEmpty:!0,targetIndex:30,x:0,y:0,rateX:8.5,rateY:14}],this.reserveLeft=[{isEmpty:!0,targetIndex:42,x:0,y:0,rateX:0,rateY:5.5},{isEmpty:!0,targetIndex:42,x:0,y:0,rateX:0,rateY:6.5},{isEmpty:!0,targetIndex:42,x:0,y:0,rateX:0,rateY:7.5},{isEmpty:!0,targetIndex:42,x:0,y:0,rateX:0,rateY:8.5}],this.reserves=[this.reserveTop,this.reserveRight,this.reserveBottom,this.reserveLeft],this.toiletTop=[{token:null,move:1,x:0,y:0,rateX:10,rateY:2},{token:null,move:3,x:0,y:0,rateX:11,rateY:2},{token:null,move:6,targetIndex:11,x:0,y:0,rateX:12,rateY:2}],this.toiletRight=[{token:null,move:1,x:0,y:0,rateX:12,rateY:10},{token:null,move:3,x:0,y:0,rateX:12,rateY:11},{token:null,move:6,targetIndex:23,x:0,y:0,rateX:12,rateY:12}],this.toiletBottom=[{token:null,move:1,x:0,y:0,rateX:4,rateY:12},{token:null,move:3,x:0,y:0,rateX:3,rateY:12},{token:null,move:6,targetIndex:35,x:0,y:0,rateX:2,rateY:12}],this.toiletLeft=[{token:null,move:1,x:0,y:0,rateX:2,rateY:4},{token:null,move:3,x:0,y:0,rateX:2,rateY:3},{token:null,move:6,targetIndex:47,x:0,y:0,rateX:2,rateY:2}],this.toilets=[this.toiletTop,this.toiletRight,this.toiletBottom,this.toiletLeft],this.homeTop=[{isEmpty:!0,targetIndex:6,x:0,y:0,rateX:7,rateY:2},{isEmpty:!0,targetIndex:6,x:0,y:0,rateX:7,rateY:3},{isEmpty:!0,targetIndex:6,x:0,y:0,rateX:7,rateY:4},{isEmpty:!0,targetIndex:6,x:0,y:0,rateX:7,rateY:5}],this.homeRight=[{isEmpty:!0,targetIndex:18,x:0,y:0,rateX:12,rateY:7},{isEmpty:!0,targetIndex:18,x:0,y:0,rateX:11,rateY:7},{isEmpty:!0,targetIndex:18,x:0,y:0,rateX:10,rateY:7},{isEmpty:!0,targetIndex:18,x:0,y:0,rateX:9,rateY:7}],this.homeBottom=[{isEmpty:!0,targetIndex:30,x:0,y:0,rateX:7,rateY:12},{isEmpty:!0,targetIndex:30,x:0,y:0,rateX:7,rateY:11},{isEmpty:!0,targetIndex:30,x:0,y:0,rateX:7,rateY:10},{isEmpty:!0,targetIndex:30,x:0,y:0,rateX:7,rateY:9}],this.homeLeft=[{isEmpty:!0,targetIndex:42,x:0,y:0,rateX:2,rateY:7},{isEmpty:!0,targetIndex:42,x:0,y:0,rateX:3,rateY:7},{isEmpty:!0,targetIndex:42,x:0,y:0,rateX:4,rateY:7},{isEmpty:!0,targetIndex:42,x:0,y:0,rateX:5,rateY:7}],this.homes=[this.homeTop,this.homeRight,this.homeBottom,this.homeLeft],this.ports=[{type:"topLeft",targetIndex:44,x:0,y:0,rateX:5,rateY:5},{type:"topRight",targetIndex:16,x:0,y:0,rateX:9,rateY:5},{type:"rightTop",targetIndex:8,x:0,y:0,rateX:9,rateY:5},{type:"rightBottom",targetIndex:28,x:0,y:0,rateX:9,rateY:9},{type:"bottomRight",targetIndex:20,x:0,y:0,rateX:9,rateY:9},{type:"bottomLeft",targetIndex:40,x:0,y:0,rateX:5,rateY:9},{type:"leftBottom",targetIndex:32,x:0,y:0,rateX:5,rateY:9},{type:"leftTop",targetIndex:4,x:0,y:0,rateX:5,rateY:5}],this.ceils=[{type:"corner",x:0,y:0,rateX:1,rateY:1},{type:"empty",x:0,y:0,rateX:2,rateY:1},{type:"empty",x:0,y:0,rateX:3,rateY:1},{type:"empty",x:0,y:0,rateX:4,rateY:1},{type:"port",targetIndex:0,x:0,y:0,rateX:5,rateY:1},{type:"empty",x:0,y:0,rateX:6,rateY:1},{type:"home",targetIndex:0,x:0,y:0,rateX:7,rateY:1},{type:"empty",x:0,y:0,rateX:8,rateY:1},{type:"port",targetIndex:1,x:0,y:0,rateX:9,rateY:1},{type:"toilet",targetIndex:0,x:0,y:0,rateX:10,rateY:1},{type:"empty",x:0,y:0,rateX:11,rateY:1},{type:"exit",x:0,y:0,rateX:12,rateY:1},{type:"corner",x:0,y:0,rateX:13,rateY:1},{type:"empty",x:0,y:0,rateX:13,rateY:2},{type:"empty",x:0,y:0,rateX:13,rateY:3},{type:"empty",x:0,y:0,rateX:13,rateY:4},{type:"port",targetIndex:2,x:0,y:0,rateX:13,rateY:5},{type:"empty",x:0,y:0,rateX:13,rateY:6},{type:"home",targetIndex:1,x:0,y:0,rateX:13,rateY:7},{type:"empty",x:0,y:0,rateX:13,rateY:8},{type:"port",targetIndex:3,x:0,y:0,rateX:13,rateY:9},{type:"toilet",targetIndex:1,x:0,y:0,rateX:13,rateY:10},{type:"empty",x:0,y:0,rateX:13,rateY:11},{type:"exit",x:0,y:0,rateX:13,rateY:12},{type:"corner",x:0,y:0,rateX:13,rateY:13},{type:"empty",x:0,y:0,rateX:12,rateY:13},{type:"empty",x:0,y:0,rateX:11,rateY:13},{type:"empty",x:0,y:0,rateX:10,rateY:13},{type:"port",targetIndex:4,x:0,y:0,rateX:9,rateY:13},{type:"empty",x:0,y:0,rateX:8,rateY:13},{type:"home",targetIndex:2,x:0,y:0,rateX:7,rateY:13},{type:"empty",x:0,y:0,rateX:6,rateY:13},{type:"port",targetIndex:5,x:0,y:0,rateX:5,rateY:13},{type:"toilet",targetIndex:2,x:0,y:0,rateX:4,rateY:13},{type:"empty",x:0,y:0,rateX:3,rateY:13},{type:"exit",x:0,y:0,rateX:2,rateY:13},{type:"corner",x:0,y:0,rateX:1,rateY:13},{type:"empty",x:0,y:0,rateX:1,rateY:12},{type:"empty",x:0,y:0,rateX:1,rateY:11},{type:"empty",x:0,y:0,rateX:1,rateY:10},{type:"port",targetIndex:6,x:0,y:0,rateX:1,rateY:9},{type:"empty",x:0,y:0,rateX:1,rateY:8},{type:"home",targetIndex:3,x:0,y:0,rateX:1,rateY:7},{type:"empty",x:0,y:0,rateX:1,rateY:6},{type:"port",targetIndex:7,x:0,y:0,rateX:1,rateY:5},{type:"toilet",targetIndex:3,x:0,y:0,rateX:1,rateY:4},{type:"empty",x:0,y:0,rateX:1,rateY:3},{type:"exit",x:0,y:0,rateX:1,rateY:2}],this.init()}init(){const e=.5*this.ceilSize+r.boardOffset;[...this.reserves,...this.toilets,...this.homes,this.ports,this.ceils].forEach((t=>{t.forEach((t=>{t.x=e+this.ceilSize*t.rateX,t.y=e+this.ceilSize*t.rateY}))}))}update(){G.context.drawImage(this.image,this.imageOffset,this.imageOffset,this.imageSize,this.imageSize)}},V=class{constructor(t,n){this.img=e.dice,this.x=t-42,this.y=n-42,this.frameSize=84,this.throwDuration=r.diceThrowDuration,this.fps=30,this.frameDuration=Math.floor(1e3/this.fps),this.frameTimeout=this.frameDuration,this.framePathSize=Math.floor(this.throwDuration/this.frameDuration),this.framePath=[],this.framePoint={x:0,y:0},this.value=this.getNewValue(),this.pointer=new class{constructor(t){this.image=e.dicePointer,this.x=t.x+41,this.y=t.y+41,this.scaleDuration=r.diceActiveDuration/2,this.maxSize=160,this.minSize=80,this.scaleRate=(this.maxSize-this.minSize)/this.scaleDuration,this.isScaleUp=!0,this.size=this.minSize,this.halfSize=this.size/2}setMinSize(){this.size=this.minSize,this.halfSize=this.size/2}update(e){this.isScaleUp?(this.size+=this.scaleRate*e,this.size>=this.maxSize&&(this.isScaleUp=!1)):(this.size-=this.scaleRate*e,this.size<=this.minSize&&(this.isScaleUp=!0)),this.halfSize=this.size/2,G.context.drawImage(this.image,this.x-this.halfSize,this.y-this.halfSize,this.size,this.size)}}(this),this.isActive=!1}getNewValue(){const e=function(){let e=0,t=0;const n=te.players[te.currentTurn];return!!n&&(n.tokens.forEach((n=>{n.container===n.reserve&&e++,n.container===te.board.ceils&&t++})),e>t)}()&&Math.random()<.25?6:Math.ceil(6*Math.random());switch(e){case 1:this.framePoint.x=0,this.framePoint.y=Math.random()<.5?4*this.frameSize:12*this.frameSize;break;case 2:this.framePoint.x=4*this.frameSize,this.framePoint.y=Math.random()<.5?4*this.frameSize:12*this.frameSize;break;case 5:this.framePoint.x=12*this.frameSize,this.framePoint.y=Math.random()<.5?4*this.frameSize:12*this.frameSize;break;case 6:this.framePoint.x=8*this.frameSize,this.framePoint.y=Math.random()<.5?4*this.frameSize:12*this.frameSize;break;case 3:this.framePoint.x=4*Math.floor(4*Math.random())*this.frameSize,this.framePoint.y=0;break;case 4:this.framePoint.x=4*Math.floor(4*Math.random())*this.frameSize,this.framePoint.y=8*this.frameSize;break;default:e=6}return e}throw(){if(this.framePath.length)return 0;let e="";for(;e.length<this.framePathSize;)e+=(""+Math.random()).slice(2);this.value=this.getNewValue(),this.framePath.push(this.framePoint);let t=Math.floor(8*Math.random()),{x:n,y:i}=this.framePoint;const o=15*this.frameSize;for(let r=0;r<this.framePathSize;r++)0!==t&&4!==t&&(n+=t<4?this.frameSize:-this.frameSize,n<0&&(n=o),n>o&&(n=0)),2!==t&&6!==t&&(i+=t>2&&t<6?this.frameSize:-this.frameSize,i<0&&(i=o),i>o&&(i=0)),this.framePath.push({x:n,y:i}),+e[r]<2&&(t--,t<0&&(t=7)),+e[r]>7&&(t++,t>7&&(t=0))}update(e){this.isActive&&this.pointer.update(e),this.framePath.length&&(this.frameTimeout-=e,this.frameTimeout<=0&&(this.frameTimeout+=this.frameDuration,this.framePoint=this.framePath.pop())),G.context.drawImage(this.img,this.framePoint.x,this.framePoint.y,this.frameSize,this.frameSize,this.x,this.y,this.frameSize,this.frameSize)}};let W=0;const q=class{constructor(e="",t=G.layers.length,n=[]){this.name=e||"layer"+W++,this.zIndex=t,this.objects=n,t===G.layers.length?G.layers.push(this):(G.layers.splice(t,0,this),G.layers.forEach(((e,t)=>e.zIndex=t)))}update(e){this.objects.forEach((t=>t.update(e)))}remove(e){this.objects=this.objects.filter((t=>t!==e))}add(e){this.objects.push(e)}moveUp(e){this.objects=this.objects.filter((t=>t!==e)),this.objects.push(e)}clear(){this.objects=[]}},N=class{constructor(e,t){this.callback=e,this.milliseconds=t,G.layers[0].add(this)}update(e){this.milliseconds-=e,this.milliseconds<=0&&(setTimeout((()=>this.callback()),0),G.layers[0].remove(this))}},$=class{constructor(t){this.player=t,this.image=t.tokenImage,this.maxSize=128,this.minSize=96,this.size=this.minSize,this.halfSize=this.size/2,this.startPoint=t.startPoint,this.reserve=te.board.reserves[t.startPoint],this.home=te.board.homes[t.startPoint],this.container=this.reserve,this.index=this.player.tokens.length,this.x=this.container[this.index].x,this.y=this.container[this.index].y,this.stepDuration=r.tokenStepDuration,this.halfStepDuration=this.stepDuration/2,this.sizeRate=(this.maxSize-this.minSize)/this.halfStepDuration,this.stepTimeout=this.stepDuration,this.speed=0,this.steps=0,this.direction=0,this.target=null,this.path=[],this.isGoHome=!1,this.isBot=t.isBot,this.pointer=new class{constructor(t,n){this.image=n?e.tokenPointerBot:e.tokenPointerHuman,this.scaleDuration=r.tokenPointerScaleDuration,this.maxSize=148,this.minSize=120,this.size=this.minSize+(this.maxSize-this.minSize)/4*t,this.halfSize=this.size/2,this.scaleRate=(this.maxSize-this.minSize)/this.scaleDuration,this.direction=0,this.isScaleUp=!0}draw(e,t){this.isScaleUp?(this.size+=this.scaleRate*t,this.size>=this.maxSize&&(this.isScaleUp=!1,this.size=this.maxSize)):(this.size-=this.scaleRate*t,this.size<=this.minSize&&(this.isScaleUp=!0,this.size=this.minSize)),this.halfSize=this.size/2,G.context.drawImage(this.image,e.x-this.halfSize,e.y-this.halfSize,this.size,this.size)}}(this.index,this.isBot),this.isAvailable=!1,this.isActive=!1}checkCeilAllTokens(e,t){const n=te.players.length;for(let i=0;i<n;i++){const n=this.checkCeilPlayerTokens(e,t,te.players[i]);if(n)return n}return!1}checkCeilPlayerTokens(e,t,n=this.player){const i=n.tokens.length;for(let o=0;o<i;o++){const i=n.tokens[o];if(i.container===e&&i.index===t&&i!==this)return i}return!1}getPath(e){switch(this.path=[],this.container){case this.reserve:this.checkPathFromReserve(e);break;case te.board.toiletTop:case te.board.toiletRight:case te.board.toiletBottom:case te.board.toiletLeft:this.checkPathInToilet(e);break;case this.home:this.checkPathInHome(e);break;default:this.checkPathInMainBoard(e)}this.path.length?this.isAvailable=!0:this.isAvailable=!1}checkPathFromReserve(e){6===e&&(this.checkCeilPlayerTokens(te.board.ceils,this.reserve[0].targetIndex)||(this.isGoHome=!1,this.addPathPoint(te.board.ceils,this.reserve[0].targetIndex)))}checkPathInToilet(e){e===this.container[this.index].move&&("targetIndex"in this.container[this.index]?this.addPathPoint(te.board.ceils,this.container[this.index].targetIndex):this.addPathPoint(this.container,this.index+1))}checkPathInHome(e,t=this.index){const n=this.home.length-1-t;if(n<=0||e>n)return this.path=[];const i=t+e;for(let e=t+1;e<=i;e++){if(this.checkCeilPlayerTokens(this.home,e))return this.path=[];this.addPathPoint(this.home,e)}}checkPathInMainBoard(e){if(this.isGoHome&&"home"===te.board.ceils[this.index].type&&te.board.ceils[this.index].targetIndex===this.startPoint)return this.checkCeilPlayerTokens(this.home,0)?this.path=[]:(this.addPathPoint(this.home,0),void this.checkPathInHome(e-1,0));let t=this.isGoHome,n=this.index;for(;e>0;){n++,n>=te.board.ceils.length&&(n=0);const i=this.container[n].type;if("corner"===i&&this.checkCeilAllTokens(te.board.ceils,n))return this.path=[];if("home"===i&&t&&te.board.ceils[n].targetIndex===this.startPoint&&e>1)return this.checkCeilAllTokens(te.board.ceils,n)||this.checkCeilPlayerTokens(this.home,0)?this.path=[]:(this.addPathPoint(te.board.ceils,n),this.addPathPoint(this.home,0),void(e>2&&this.checkPathInHome(e-2,0)));if(e>1){if(this.checkCeilAllTokens(te.board.ceils,n))return this.path=[];this.addPathPoint(te.board.ceils,n)}else{if(this.checkCeilPlayerTokens(te.board.ceils,n))return this.path=[];switch(i){case"port":const e=te.board.ceils[n].targetIndex,t=te.board.ports[e].targetIndex;if(this.checkCeilPlayerTokens(te.board.ceils,t))return this.path=[];this.addPathPoint(te.board.ceils,n),this.addPathPoint(te.board.ports,e),this.addPathPoint(te.board.ceils,t);break;case"toilet":const i=te.board.ceils[n].targetIndex;this.addPathPoint(te.board.ceils,n),this.addPathPoint(te.board.toilets[i],0);break;default:this.addPathPoint(te.board.ceils,n)}}e--}}addPathPoint(e,t){this.path.push({container:e,index:t,x:e[t].x,y:e[t].y})}pushPathInToilet(){this.path=[],"targetIndex"in this.container[this.index]?this.addPathPoint(te.board.ceils,this.container[this.index].targetIndex):this.addPathPoint(this.container,this.index+1),this.startStep()}pushPathToReserve(){this.path=[];const e=this.reserve.length,n=new Array(e);this.player.tokens.forEach((e=>{e.container===this.reserve&&(n[e.index]=!0)}));for(let t=0;t<e;t++)if(!n[t]){this.addPathPoint(this.reserve,t);break}A(t.destroy),this.startStep()}activation(){this.isAvailable&&(this.player.tokens.forEach((e=>e.isAvailable=!1)),this.isActive=!0,this.startStep())}startStep(){if(this.player.layer.moveUp(this),this.target=this.path.shift(),this.target.container===te.board.toiletTop||this.target.container===te.board.toiletRight||this.target.container===te.board.toiletBottom||this.target.container===te.board.toiletLeft){const e=this.checkCeilAllTokens(this.target.container,this.target.index);e&&e.pushPathInToilet()}this.setDirection();const e=this.getDistance();switch(this.speed=e/this.stepDuration,this.container){case this.reserve:A(t.startToken);break;case te.board.toiletTop:case te.board.toiletRight:case te.board.toiletBottom:case te.board.toiletLeft:this.target.container===te.board.ceils?A(t.toiletExit):A("toilet");break;default:this.target.container!==te.board.toiletTop&&this.target.container!==te.board.toiletRight&&this.target.container!==te.board.toiletBottom&&this.target.container!==te.board.toiletLeft||A(t.toiletStart),this.target.container===te.board.ports&&A(t.port)}}setDirection(){this.direction=Math.atan2(this.target.y-this.y,this.target.x-this.x)}getDistance(){let e=this.target.x-this.x,t=this.target.y-this.y;return Math.sqrt(e*e+t*t)}move(e){this.x+=Math.cos(this.direction)*e,this.y+=Math.sin(this.direction)*e}endStep(){if(this.size=this.minSize,this.halfSize=this.size/2,this.stepTimeout=this.stepDuration,this.container=this.target.container,this.index=this.target.index,this.x=this.target.x,this.y=this.target.y,this.target=null,this.container===te.board.ceils){const e=this.checkCeilAllTokens(te.board.ceils,this.index);e&&e.pushPathToReserve()}this.container===this.home&&0===this.index?A(t.home):A("step"),this.path.length?this.startStep():this.endMove()}endMove(){if(this.isGoHome||this.container===te.board.ceils&&this.index===this.reserve[0].targetIndex||(this.isGoHome=!0),this.container===this.home){let e=!0;this.player.tokens.forEach((t=>{t.container!==this.home&&(e=!1)})),e&&(te.isEnd=!0)}if(this.container===te.board.ceils&&"corner"===this.container[this.index].type){A(t.corner);let e=!0;this.player.tokens.forEach((t=>{t.container===te.board.ceils&&"corner"===t.container[t.index].type||(e=!1)})),e&&(te.isEnd=!0)}this.isActive&&(this.isActive=!1,new N((()=>this.player.diceFinished()),1e3))}update(e){this.isAvailable&&this.pointer.draw({x:this.x,y:this.y},e),this.target&&(this.stepTimeout-=e,this.stepTimeout>this.halfStepDuration?this.size+=this.sizeRate*e:this.size-=this.sizeRate*e,this.halfSize=this.size/2,this.stepTimeout>0?this.move(e*this.speed):this.endStep()),G.context.drawImage(this.image,this.x-this.halfSize,this.y-this.halfSize,this.size,this.size)}},j=class{constructor(t,n,i){this.getPointerPosition(n),this.image=n%2==0?e.pointerPlayerH:e.pointerPlayerV,this.tokenImage=t,this.frameWidth=n%2==0?480:120,this.frameHeight=n%2==0?120:480,this.frame=0,this.fps=30,this.frameDuration=Math.floor(1e3/this.fps),this.frameTimeout=this.frameDuration,this.frames=this.getFrames(),this.dices=[],this.dice=null,this.isGetDouble=!1,this.turns=0,this.startPoint=n,this.tokens=[],this.isBot=i,this.layer=G.getLayer("players"),this.generateTokens()}getPointerPosition(e){e%2==0?(this.x=r.boardOffset+5.5*r.ceilSize,this.y=0===e?r.boardOffset:r.boardOffset+14*r.ceilSize):(this.y=r.boardOffset+5.5*r.ceilSize,this.x=3===e?r.boardOffset:r.boardOffset+14*r.ceilSize)}getFrames(){const e=[];for(let t=0;t<this.image.height;t+=this.frameHeight)for(let n=0;n<this.image.width;n+=this.frameWidth)e.push({x:n,y:t});return e}generateTokens(){const e=G.getLayer("tokens");for(let t=0;t<4;t++){const t=new $(this);this.tokens.push(t),e.add(t)}}startTurn(){this.layer.add(this),this.throwDices()}throwDices(){this.turns++,A(t.dice2),te.dices.forEach((e=>e.throw())),this.isGetDouble=te.dices[0].value===te.dices[1].value,te.dices[0].value>=te.dices[1].value?this.dices=[1,0]:this.dices=[0,1],new N((()=>this.useDice()),r.diceThrowDuration)}useDice(){this.dice=te.dices[this.dices.pop()],this.dice.isActive=!0;const e=[];this.tokens.forEach((t=>{t.getPath(this.dice.value),t.isAvailable&&e.push(t)})),e.length?this.isBot&&new N((()=>this.botActivation(e)),r.diceActiveDuration):new N((()=>this.diceFinished()),r.diceActiveDuration)}botActivation(e){if(1===e.length)return void e[0].activation();const t=[],n=[],i=[];e.sort((()=>Math.random()-.5));for(let o=0;o<e.length;o++){const r=e[o],s=r.path[r.path.length-1];te.board.toilets.includes(r.container)&&(r.checkCeilPlayerTokens(te.board.ceils,r.container[2].targetIndex,r.player)?console.log("MOVE IN TOILET AND FRIENDLY TOKEN ON EXIT"):console.log("JUST MOVE IN TOILET")),r.container===r.reserve||s.container===te.board.ceils&&"corner"===s.container[s.index].type||s.container===r.home||s.container===te.board.ceils&&"port"===s.container[s.index].type&&s.container[s.index].targetIndex%2==0?t.push(r):te.board.toilets.includes(s.container)&&0===s.index||te.board.toilets.includes(r.container)&&r.checkCeilPlayerTokens(te.board.ceils,r.container[2].targetIndex,r.player)?i.push(r):s.container===te.board.ceils&&"home"===s.container[s.index].type||s.container===te.board.ceils&&"port"===s.container[s.index].type&&s.container[s.index].targetIndex%2==1||this.container===te.board.ceils&&"corner"===this.container[this.index].type?i.unshift(r):s.container===te.board.ceils&&"exit"===s.container[s.index].type?n.push(r):n.unshift(r)}t.length?t[0].activation():n.length?n[0].activation():i[0].activation()}diceFinished(){this.dice.isActive=!1,this.dice.pointer.setMinSize(),this.dices.length&&!te.isEnd?this.useDice():this.isGetDouble&&!te.isEnd&&this.turns<3?this.throwDices():this.endTurn()}endTurn(){this.turns=0,this.layer.remove(this),te.nextTurn()}update(e){this.frameTimeout-=e,this.frameTimeout<=0&&(this.frameTimeout+=this.frameDuration,this.frame++,this.frame===this.frames.length&&(this.frame=0)),G.context.drawImage(this.image,this.frames[this.frame].x,this.frames[this.frame].y,this.frameWidth,this.frameHeight,this.x,this.y,this.frameWidth,this.frameHeight)}},Q=class{constructor(e="",t=0,n=0,i){this.x=t,this.y=n,this.weight=i.weight||"normal",this.style=i.style||"normal",this.size=i.size||24,this.family=i.family||"Arial",this.color=i.color||"#00ff00",this.strokeColor=i.strokeColor||"#00000000",this.strokeWidth=i.strokeWidth||0,this.align=i.align?this.getTextAlign(i.align):"left",this.offsetX=0,this.font=`${this.weight} ${this.style} ${this.size}px ${this.family}, Arial, sans-serif`,this.img=document.createElement("canvas"),this.ctx=this.img.getContext("2d"),this.img.width=this.getTextWidth(e),this.img.height=this.size,this.isExist=!0,this.render(e)}getTextAlign(e){switch(e){case"right":return"right";case"center":return"center";default:return"left"}}getTextWidth(e){return this.ctx.font=this.font,this.ctx.measureText(e||" ").width}render(e){this.ctx.clearRect(0,0,this.img.width,this.img.height),this.img.width=this.getTextWidth(e),"right"===this.align&&(this.offsetX=this.img.width),"center"===this.align&&(this.offsetX=Math.floor(this.img.width/2)),this.ctx.font=this.font,this.ctx.textBaseline="top",this.ctx.textAlign=this.align,this.ctx.fillStyle=this.color,this.ctx.fillText(e||" ",this.offsetX,0),this.strokeWidth&&(this.ctx.strokeStyle=this.strokeColor,this.ctx.lineWidth=this.strokeWidth,this.ctx.strokeText(e||" ",this.offsetX,0))}draw(e){e.drawImage(this.img,this.x-this.offsetX,this.y)}},Z=document.getElementById("loadInfoDiv");!function(n,i){let r=Object.keys(e).length+Object.keys(t).length;o.files=r;for(const t in e){const n=new Image;n.src="./src/images/"+e[t],n.onload=()=>{e[t]=n,s()}}for(const e in t){const n=new Audio("./src/sounds/"+t[e]);n.oncanplaythrough=i=>{i.target.oncanplaythrough=null,t[e]=n,s()},n.load()}function s(){var e;o.loaded++,e=o,Z.innerHTML=`Загружено &nbsp; <span> ${e.loaded} / ${e.files} </span> &nbsp; файлов.`,r--,r||(O(Z),setTimeout((()=>D(X)),600),ne())}}(),new q("timers",0);const K=new q("board",1),J=new q("dices",2),ee=(new q("players",3),new q("tokens",4),new q("menu",5)),te={tokens:[],menu:null,isStart:!1,players:[],currentTurn:0,board:null,dices:[],isEnd:!1,nextTurn(){if(this.isEnd)return this.end();this.currentTurn++,this.currentTurn===this.players.length&&(this.currentTurn=0),this.players[this.currentTurn].startTurn()},end(){te.isStart=!1;const n=new class{constructor(n,i){this.endGameCallback=n,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=G.width,this.canvas.height=G.height,this.button={x:G.x-360,y:G.y+180,width:720,height:180},this.TextStyle={size:120,family:"clip",weight:"600",color:"#000000",align:"center"};const o=i.isBot?"Компьютер выиграл":"Игрок выиграл";this.context.drawImage(e.pointerPlayerH,0,0,480,120,G.x-360,G.y-360,720,180),this.playerLabel=new Q(o,G.x,G.x-340,this.TextStyle),this.playerLabel.draw(this.context),this.context.drawImage(i.image,G.x-90,G.y-90,180,180),this.context.drawImage(e.menuButton,this.button.x,this.button.y,this.button.width,this.button.height),this.buttonText=new Q("В МЕНЮ",this.button.x+360,this.button.y+10,{size:140,family:"clip",weight:"600",color:"#ff00bc",align:"center"}),this.buttonText.draw(this.context),A(i.isBot?t.lose:t.win)}click(e,n){e>this.button.x&&e<this.button.x+this.button.width&&n>this.button.y&&n<this.button.y+this.button.height&&(A(t.menuClick),G.canvas.style.opacity=0,setTimeout((()=>{this.endGameCallback(),G.canvas.style.opacity=1}),1e3))}update(){G.context.drawImage(this.canvas,0,0)}}((()=>{te.tokens=[],te.isStart=!1,te.players=[],te.currentTurn=0,te.board=null,te.dices=[],te.isEnd=!1,G.layers.forEach((e=>e.clear())),ne()}),{isBot:this.players[this.currentTurn].isBot,image:this.players[this.currentTurn].tokenImage});te.menu=n,ee.add(n)}};function ne(){te.menu=null,te.tokens=[e.tokenBomb,e.tokenButton,e.tokenCap,e.tokenCoin,e.tokenCrystal,e.tokenDragon,e.tokenEye,e.tokenHelmet,e.tokenMask,e.tokenMolecule,e.tokenMoon,e.tokenNut,e.tokenPlane,e.tokenShark,e.tokenShield,e.tokenSkull,e.tokenStone,e.tokenToy,e.tokenUfo,e.tokenWheel],te.menu=new class{constructor(e){this.isStart=!1,this.startGameCallback=e,this.state={players:[{isUsed:!0,isBot:!1,tokenIndex:2},{isUsed:!0,isBot:!0,tokenIndex:11},{isUsed:!0,isBot:!0,tokenIndex:1},{isUsed:!1,isBot:!0,tokenIndex:1/0}],tokens:te.tokens.map(((e,t)=>t)),music:!0,effects:!0,start:!0},this.state.players.forEach((e=>{this.state.tokens=this.state.tokens.filter((t=>e.tokenIndex!==t))})),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=G.width,this.canvas.height=G.height,this.underlay={width:720,height:180},this.button={width:180,height:180},this.underlay1={x:120,y:G.y-270},this.underlay2={x:G.x+60,y:G.y-270},this.underlay3={x:120,y:G.y+90},this.underlay4={x:G.x+60,y:G.y+90},this.btnP1User={x:this.underlay1.x+90,y:this.underlay1.y,width:this.button.width,height:this.button.height},this.btnP1Token={x:this.underlay1.x+450,y:this.underlay1.y,width:this.button.width,height:this.button.height},this.btnP2User={x:this.underlay2.x+90,y:this.underlay2.y,width:this.button.width,height:this.button.height},this.btnP2Token={x:this.underlay2.x+450,y:this.underlay2.y,width:this.button.width,height:this.button.height},this.btnP3User={x:this.underlay3.x+90,y:this.underlay3.y,width:this.button.width,height:this.button.height},this.btnP3Token={x:this.underlay3.x+450,y:this.underlay3.y,width:this.button.width,height:this.button.height},this.btnP4User={x:this.underlay4.x+90,y:this.underlay4.y,width:this.button.width,height:this.button.height},this.btnP4Token={x:this.underlay4.x+450,y:this.underlay4.y,width:this.button.width,height:this.button.height},this.btnMusic={x:this.underlay3.x+90,y:this.underlay3.y+360,width:this.button.width,height:this.button.height},this.btnEffects={x:this.underlay4.x+450,y:this.underlay4.y+360,width:this.button.width,height:this.button.height},this.btnStart={x:G.x-360,y:this.underlay4.y+360,width:this.underlay.width,height:this.underlay.height},this.playerTextStyle={size:60,family:"clip",weight:"600",color:"#ffffff",align:"center"},this.playerLabels=[new Q("",this.underlay1.x+360,this.underlay1.y+200,this.playerTextStyle),new Q("",this.underlay2.x+360,this.underlay2.y+200,this.playerTextStyle),new Q("",this.underlay3.x+360,this.underlay3.y+200,this.playerTextStyle),new Q("",this.underlay4.x+360,this.underlay4.y+200,this.playerTextStyle)],this.buttonText=new Q("СТАРТ",this.btnStart.x+360,this.btnStart.y+10,{size:140,family:"clip",weight:"600",color:"#ff00bc",align:"center"}),this.labelText=new Q("ПАРЧИС",G.x,G.y-960,{size:540,family:"clip",weight:"600",color:"#00f66c",align:"center"}),this.labelSubText=new Q("Квадрат",G.x+320,G.y-600,{size:210,family:"clip",weight:"600",color:"#ff00bc",align:"center"}),this.versionText=new Q(`ВЕРСИЯ: ${r.version}`,160,this.canvas.height-90,{size:68,family:"clip",weight:"600",color:"#ffffff",align:"left"}),this.render()}updatePlayerLabels(){function e(e,t,n){return`${e?t?"компьютер":"игрок":"без игрока"} ${n}`}this.state.players.forEach(((t,n)=>{switch(n){case 0:this.playerLabels[n].render(e(t.isUsed,t.isBot,"снизу"));break;case 1:this.playerLabels[n].render(e(t.isUsed,t.isBot,"слева"));break;case 2:this.playerLabels[n].render(e(t.isUsed,t.isBot,"сверху"));break;case 3:this.playerLabels[n].render(e(t.isUsed,t.isBot,"справа"))}this.playerLabels[n].draw(this.context)}))}getPlayerImage(t){return this.state.players[t].isUsed?this.state.players[t].isBot?e.menuComputer:e.menuPlayer:e.menuNoUser}getTokenImage(t){if(!this.state.players[t].isUsed||this.state.players[t].tokenIndex>=te.tokens.length)return e.menuRandom;const n=this.state.players[t].tokenIndex;return te.tokens[n]}render(){this.updateStateStart(),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.labelText.draw(this.context),this.labelSubText.draw(this.context),this.context.drawImage(e.pointerPlayerH,0,0,480,120,this.underlay1.x,this.underlay1.y,this.underlay.width,this.underlay.height),this.context.drawImage(e.pointerPlayerH,0,0,480,120,this.underlay2.x,this.underlay2.y,this.underlay.width,this.underlay.height),this.context.drawImage(e.pointerPlayerH,0,0,480,120,this.underlay3.x,this.underlay3.y,this.underlay.width,this.underlay.height),this.context.drawImage(e.pointerPlayerH,0,0,480,120,this.underlay4.x,this.underlay4.y,this.underlay.width,this.underlay.height),this.updatePlayerLabels(),this.context.drawImage(this.getPlayerImage(0),this.btnP1User.x,this.btnP1User.y,this.button.width,this.button.height),this.context.drawImage(this.getTokenImage(0),this.btnP1Token.x,this.btnP1Token.y,this.button.width,this.button.height),this.context.drawImage(this.getPlayerImage(1),this.btnP2User.x,this.btnP2User.y,this.button.width,this.button.height),this.context.drawImage(this.getTokenImage(1),this.btnP2Token.x,this.btnP2Token.y,this.button.width,this.button.height),this.context.drawImage(this.getPlayerImage(2),this.btnP3User.x,this.btnP3User.y,this.button.width,this.button.height),this.context.drawImage(this.getTokenImage(2),this.btnP3Token.x,this.btnP3Token.y,this.button.width,this.button.height),this.context.drawImage(this.getPlayerImage(3),this.btnP4User.x,this.btnP4User.y,this.button.width,this.button.height),this.context.drawImage(this.getTokenImage(3),this.btnP4Token.x,this.btnP4Token.y,this.button.width,this.button.height),this.context.drawImage(this.state.music?e.menuMusicOn:e.menuMusicOff,this.btnMusic.x,this.btnMusic.y,this.button.width,this.button.height),this.context.drawImage(this.state.start?e.menuButton:e.menuButtonLock,this.btnStart.x,this.btnStart.y,this.underlay.width,this.underlay.height),this.context.drawImage(this.state.effects?e.menuEffectsOn:e.menuEffectsOff,this.btnEffects.x,this.btnEffects.y,this.button.width,this.button.height),this.buttonText.draw(this.context),this.context.drawImage(e.menuLogo,G.x+240,this.canvas.height-180),this.versionText.draw(this.context)}checkClickButton(e,t,n){return e>n.x&&e<n.x+n.width&&t>n.y&&t<n.y+n.height}click(e,n){this.isStart||(this.checkClickButton(e,n,this.btnStart)&&this.state.start&&this.startGame(),this.checkClickButton(e,n,this.btnMusic)&&(this.state.music=!this.state.music,k(this.state),A(t.menuMusic),this.render()),this.checkClickButton(e,n,this.btnEffects)&&(this.state.effects=!this.state.effects,k(this.state),A(t.menuEffects),this.render()),this.checkClickButton(e,n,this.btnP1User)&&this.clickPlayer(0),this.checkClickButton(e,n,this.btnP1Token)&&this.clickToken(0),this.checkClickButton(e,n,this.btnP2User)&&this.clickPlayer(1),this.checkClickButton(e,n,this.btnP2Token)&&this.clickToken(1),this.checkClickButton(e,n,this.btnP3User)&&this.clickPlayer(2),this.checkClickButton(e,n,this.btnP3Token)&&this.clickToken(2),this.checkClickButton(e,n,this.btnP4User)&&this.clickPlayer(3),this.checkClickButton(e,n,this.btnP4Token)&&this.clickToken(3))}updateStateStart(){let e=0;this.state.players.forEach((t=>{t.isUsed&&e++})),this.state.start=e>1}clickPlayer(e){A(t.menuClick),this.state.players[e].isUsed?this.state.players[e].isBot?(this.state.players[e].isUsed=!1,this.state.players[e].isBot=!1,isFinite(this.state.players[e].tokenIndex)&&(this.state.tokens.push(this.state.players[e].tokenIndex),this.state.players[e].tokenIndex=1/0)):this.state.players[e].isBot=!0:this.state.players[e].isUsed=!0,this.render()}clickToken(e){if(A(t.menuToken),!this.state.players[e].isUsed)return this.state.players[e].isUsed=!0,this.render();isFinite(this.state.players[e].tokenIndex)&&this.state.tokens.push(this.state.players[e].tokenIndex),this.state.players[e].tokenIndex=this.state.tokens.shift(),this.render()}startGame(){this.isStart=!0,A(t.menuStart),this.state.players.forEach((e=>{isFinite(e.tokenIndex)||(this.state.tokens.sort((()=>Math.random()-.5)),e.tokenIndex=this.state.tokens.pop())})),G.canvas.style.opacity=0,setTimeout((()=>{G.getLayer("menu").clear(),this.startGameCallback(this.state),setTimeout((()=>G.canvas.style.opacity=1),600)}),1200)}update(){G.context.drawImage(this.canvas,0,0)}}(ie),ee.add(te.menu),_=[e.help1,e.help2,e.help3,e.help4,e.help5,e.help6,e.help7,e.help8,e.help9,e.help10,e.help11,e.help12],m.append(e.helpBook)}function ie(e){te.isStart=!0,te.board=new R,K.add(te.board),te.dices.push(new V(G.x-63,G.y-63)),te.dices.push(new V(G.x+63,G.y+63)),te.dices.forEach((e=>J.add(e)));for(let t=0;t<e.players.length;t++)if(e.players[t].isUsed){const n=e.players[t].tokenIndex,i=(t+2)%e.players.length;te.players.push(new j(te.tokens[n],i,e.players[t].isBot))}te.currentTurn=Math.floor(Math.random()*te.players.length),new N((()=>te.nextTurn()),r.gameStartDuration)}G.canvas.onclick=function(e){const t=e.offsetX*G.sizeRate,n=e.offsetY*G.sizeRate;te.isStart?function(e,t){if(te.players[te.currentTurn].isBot)return;const n=[];let i=!0;if(te.players[te.currentTurn].tokens.forEach((e=>{e.isAvailable&&(n.push(e),e.container!==e.reserve&&(i=!1))})),0!==n.length)if(1!==n.length){for(let i=0;i<n.length;i++){const o=e-n[i].x,s=t-n[i].y;if(Math.sqrt(o*o+s*s)<r.ceilSize/2)return n[i].activation()}i&&n[0].activation()}else n[0].activation()}(t,n):te.menu&&te.menu.click(t,n)}})()})();